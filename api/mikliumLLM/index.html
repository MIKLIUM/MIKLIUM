<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>MikliumLLM</title>
  <link rel="icon" href="data:;base64,=">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#f0f4f8;--card:#fff;--accent:#007bff;--accentHover:#0056b3;--text:#222;--muted:#6b7280;--border:#e6e9ee;--chatBg:#f8f9fb;--userBubble:#007bff;--botBubble:#eef2f6}
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{font-family:"Inter",system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;display:flex;align-items:center;justify-content:center;background:var(--bg);color:var(--text);padding:16px}
    .chat-container{width:100%;max-width:680px;height:80vh;background:var(--card);border-radius:12px;box-shadow:0 8px 30px rgba(15,23,42,0.08);display:flex;flex-direction:column;overflow:hidden}
    .chat-header{padding:18px;border-bottom:1px solid var(--border);text-align:center;font-weight:600;font-size:1.25rem}
    #chatLog{flex:1;padding:18px;background:var(--chatBg);overflow:auto;display:flex;flex-direction:column;gap:12px}
    .message-bubble{padding:10px 14px;border-radius:16px;max-width:78%;line-height:1.45;word-break:break-word}
    .user-bubble{align-self:flex-end;background:var(--userBubble);color:#fff;border-bottom-right-radius:6px}
    .bot-bubble{align-self:flex-start;background:var(--botBubble);color:var(--text);border-bottom-left-radius:6px}
    .bot-bubble .bot-text{margin-bottom:6px}
    .bot-bubble .think{font-style:italic;color:var(--muted);margin-bottom:6px;padding:6px 8px;border-radius:10px;background:rgba(0,0,0,0.02)}
    .input-area{display:flex;padding:14px;border-top:1px solid var(--border);gap:10px;background:var(--card)}
    #userInput{flex:1;padding:10px 12px;border:1px solid var(--border);border-radius:10px;font-size:1rem}
    #userInput:focus{outline:none;box-shadow:0 0 0 4px rgba(0,123,255,0.08);border-color:var(--accent)}
    #sendButton{background:var(--accent);color:#fff;border:none;padding:10px 16px;border-radius:999px;font-weight:600;cursor:pointer}
    #sendButton:hover{background:var(--accentHover)}
    .small-meta{font-size:0.85rem;color:var(--muted);margin-top:6px}
  </style>
</head>
<body>
  <div class="chat-container">
    <div class="chat-header">MikliumLLM</div>
    <div id="chatLog" aria-live="polite"></div>
    <div class="input-area">
      <input id="userInput" type="text" placeholder="Type something..." autocomplete="off">
      <button id="sendButton" onclick="chat()">Send</button>
    </div>
  </div>

  <script src="mikliumllm.js"></script>
  <script>
    const chatLog = document.getElementById('chatLog');
    function escapeHtml(s){return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;')}
    function renderFromRaw(raw){
      const blocks = raw.split(/\n\s*\n/).filter(b=>b.trim().length>0);
      let html = '';
      blocks.forEach(block=>{
        const m = block.match(/User:\s*(.*?)\nMikliumLLM:\s*([\s\S]*)/);
        if(m){
          const user = escapeHtml(m[1].trim());
          const botRaw = m[2].trim();
          html += `<div class="message-bubble user-bubble">${user}</div>`;
          const parts = botRaw.split(/(<think>[\s\S]*?<\/think>)/g);
          let botHtml = '';
          parts.forEach(p=>{
            if(/^<think>/.test(p)){
              const inner = escapeHtml(p.replace(/^<think>|<\/think>$/g,'').trim());
              botHtml += `<div class="think">${inner}</div>`;
            } else {
              const t = escapeHtml(p).trim();
              if(t) botHtml += `<div class="bot-text">${t}</div>`;
            }
          });
          html += `<div class="message-bubble bot-bubble">${botHtml}</div>`;
        } else {
          const txt = escapeHtml(block.trim());
          html += `<div class="message-bubble bot-bubble">${txt}</div>`;
        }
      });
      chatLog.innerHTML = html;
      chatLog.scrollTop = chatLog.scrollHeight;
    }
    let lastRaw = '';
    const observer = new MutationObserver(()=> {
      const raw = chatLog.textContent || '';
      if(raw === lastRaw) return;
      lastRaw = raw;
      observer.disconnect();
      renderFromRaw(raw);
      observer.observe(chatLog, {characterData:true,subtree:true,childList:true});
    });
    observer.observe(chatLog, {characterData:true,subtree:true,childList:true});
    document.getElementById('userInput').addEventListener('keypress', e=>{
      if(e.key === 'Enter'){ e.preventDefault(); chat(); }
    });
  </script>
</body>
</html>
